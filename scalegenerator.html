<html>
<head>
    <title>Scale Generator</title>
    <style type="text/css">
        body {
            text-align: center;
        }
        #Results {
            font-family: Consolas;
        }
    </style>
</head>
<body>
<div id="ControlPanel">
    <input type="checkbox" id="ControlPanel_Debug"    checked>debug                     </input><br>
    <input type="checkbox" id="ControlPanel_SemiSemi"        >allow subsequent semitones</input><br>
<!--     <input type="radio" name="ControlPanel_Output" value="INTERVALS" checked>Intervals
    <input type="radio" name="ControlPanel_Output" value="NOTES"            >Notes<br> -->
    <button id="ControlPanel_Btn" onclick="main()">Generate Scale</button>
</div>
<hr>
<div id="Results">

</div>

</body>
</html>
<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
<script type="text/javascript">

// ##### DECL

function safeSumList(listToSum) {
    if(listToSum == undefined ||  listToSum == null || listToSum.length == 0) {
        return 0;
    }
    return listToSum.reduce((x,sum)=>sum+x);
}

function debug(msg) {
    log(msg);
}

function print(msg) {
    log(msg, true);
}

function log(msg, force = false) {
    if(!force && !ControlPanel_Debug.checked) {
        return;
    }
    Results.innerText = document.getElementById('Results').innerText + "\n" + msg;
}

function getRandomInt(min, max) {
    max = max + 1; // more convenient to make both `min` and `max` inclusive
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min) + min);
}

function intervalsToNotes(intrvlArr, startingNote) {
    const NOTES = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
    return NOTES;
}

function getIntervalBySemitonalWidth(minSemitones, maxSemitones) {
    return getRandomInt(minSemitones, maxSemitones) * 0.5;
}

function clearOutput() {
    Results.innerText = "";
}

function arrToString(arr) {
    return arr.toLocaleString().replaceAll(",",", ");
}

function getIntervalArr(allowConsecutiveSemitones) {
    intervalArr = Array();
    lastInterval = 0;
    shouldContinue = true;

    while(shouldContinue) {
        intervalSum = safeSumList(intervalArr);
        tonesMuchLeft = 6 - intervalSum;
        debug("Tones left ["+tonesMuchLeft+"]");
        switch(tonesMuchLeft) {
            case 0  : {
                debug("Octave complete");
                shouldContinue = false;
                break;
            }
            case 0.5: {
                debug("Only 0.5 semitones left - adding that");
                intervalToPush = 0.5;
                break;
            }
            case 1  : {
                if(lastInterval == 0.5) {
                    debug("Only 1 semitone left, and last one was a semitone");
                    intervalToPush = !allowConsecutiveSemitones ? 1 : getIntervalBySemitonalWidth(1,2);
                } else {
                    intervalToPush = getIntervalBySemitonalWidth(1,2);
                }
                break;
            }
            default : {
                if(lastInterval == 0.5 && !allowConsecutiveSemitones) {
                    debug("Last interval was a semitone and no consequitves are allowed - enforcing");
                    intervalToPush = getIntervalBySemitonalWidth(2,3);
                } else {
                    intervalToPush = getIntervalBySemitonalWidth(1,3);
                }
                break;
            }
        }
        if (shouldContinue) {
            debug("Adding ["+intervalToPush+"]");
            intervalArr.push(intervalToPush);
            lastInterval = intervalToPush;
        }
    }

    return intervalArr;
}


// ##### MAIN

function main() {
    clearOutput();
    debug("=== START ===");

    intervalArr = getIntervalArr(ControlPanel_SemiSemi.checked);
    print("Intervals [" + arrToString(intervalArr) + "]");
    debug("Sum       [" + safeSumList(intervalArr) + "]");
    
    notes = intervalsToNotes(intervalArr);
    print("Notes     [" + arrToString(notes)       + "]");

    // playNotes(notes);

    debug("=== FINISH ===");
}


</script>